<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>blockframes documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">blockframes documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>Key</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>libs/utils/src/lib/helpers.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#address">address</a>
                                </li>
                                <li>
                                        <a href="#ensDomain">ensDomain</a>
                                </li>
                                <li>
                                        <a href="#isLinked">isLinked</a>
                                </li>
                                <li>
                                        <a href="#isMainKey">isMainKey</a>
                                </li>
                                <li>
                                        <a href="#keyStore">keyStore</a>
                                </li>
                                <li>
                                        <a href="#name">name</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="address"></a>
                                        <span class="name"><b>address</b><a href="#address"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>address:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="ensDomain"></a>
                                        <span class="name"><b>ensDomain</b><a href="#ensDomain"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>ensDomain:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="isLinked"></a>
                                        <span class="name"><b>isLinked</b><a href="#isLinked"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>isLinked:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Does the key also exists inside the ERC1077 </p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="isMainKey"></a>
                                        <span class="name"><b>isMainKey</b><a href="#isMainKey"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>isMainKey:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="keyStore"></a>
                                        <span class="name"><b>keyStore</b><a href="#keyStore"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>keyStore:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="name"></a>
                                        <span class="name"><b>name</b><a href="#name"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { toASCII } from &quot;punycode&quot;;
import { baseEnsDomain, factoryContract } from &quot;@env&quot;;
import { keccak256 } from &#x27;@ethersproject/keccak256&#x27;
import { BigNumber } from &#x27;@ethersproject/bignumber&#x27;
import { Provider } from &#x27;@ethersproject/providers&#x27;
import { toUtf8Bytes } from &#x27;@ethersproject/strings&#x27;
import { ERC1077 } from &#x27;@blockframes/contracts&#x27;;
import firebase from &quot;firebase&quot;;

export interface AddressParts {
  start: string;
  middle: string;
  end: string;
}

export interface Key {
  name: string,
  ensDomain: string,
  keyStore: string,
  address: string,
  isMainKey: boolean,
  /** Does the key also exists inside the ERC1077 */
  isLinked: boolean,
}

export function keyToAddressPart(key: Key, length: number): AddressParts {
  const { address } &#x3D; JSON.parse(key.keyStore);
  return {start: address.slice(0, length), middle: address.slice(length, address.length - length), end: address.slice(-length)};
}

/** Get first part of an ens domain : &#x60;alice.blockframes.eth&#x60; -&gt; &#x60;alice&#x60; */
export function getNameFromENS(ensDomain: string) {
  return ensDomain.split(&#x27;.&#x27;)[0];
}

/**
 * Convert email to username and sanitize it:
 * convert to lower case punycode and replace special chars by their ASCII code
 * then add base ens domain
 * @example &#x60;漢micHel+9@example.com&#x60; -&gt; &#x60;xn--michel439-2c2s.blockframes.eth&#x60;
 */
// TODO issue#714 (Laurent work on a way to get those functions in only one place)
export function emailToEnsDomain(email: string) { // !!!! there is a copy of this function in &#x27;apps/backend-functions/src/relayer.ts&#x27;
  return toASCII(email.split(&#x27;@&#x27;)[0]).toLowerCase()
    .split(&#x27;&#x27;)
    .map(char &#x3D;&gt; /[^\w\d-.]/g.test(char) ? char.charCodeAt(0) : char) // replace every non a-z or 0-9 chars by their ASCII code : &#x27;?&#x27; -&gt; &#x27;63&#x27;
    .join(&#x27;&#x27;) + &#x27;.&#x27; + baseEnsDomain;
}

/** same as &#x60;emailToEnsDomain&#x60; but for org name
 * @see &#x60;emailToEnsDomain(email: string): string&#x60;
 */
export function orgNameToEnsDomain(orgName: string) {
  return emailToEnsDomain(orgName.replace(&#x27; &#x27;, &#x27;-&#x27;));
}

/**
 * This function precompute a contract address as defined in the EIP 1014 (Skinny Create 2)
 * @param ensDomain this is use as a salt (salt need to be unique for each user)
 * @param provider ethers provider
 */
// TODO issue#714 (Laurent work on a way to get those functions in only one place)
export async function precomputeAddress(ensDomain: string, provider: Provider) { // !!!! there is a copy of this function in &#x27;apps/backend-functions/src/relayer.ts&#x27;

  const factoryAddress &#x3D; await provider.resolveName(factoryContract).then(address &#x3D;&gt; address.substr(2));
  const salt &#x3D; keccak256(toUtf8Bytes(getNameFromENS(ensDomain))).substr(2);
  const byteCodeHash &#x3D; keccak256(&#x60;0x${ERC1077.bytecode}&#x60;).substr(2);

  const payload &#x3D; &#x60;0xff${factoryAddress}${salt}${byteCodeHash}&#x60;;

  return &#x60;0x${keccak256(payload).slice(-40)}&#x60;; // first 40 bytes of the hash of the payload
}

/**
 * Transform a number into an hex string with a &#x60;0x&#x60; prefix
 * @example numberToHexString(1337) &#x3D; &#x27;0x539&#x27;
 */
export function numberToHexString(num: number) {
  return BigNumber.from(num).toHexString();
}

/**
 * Transform a &#x60;0x&#x60; prefixed hex string into a 256 bits padded with 0
 * @param hexString a &#x60;0x&#x60; prefixed hex string
 */
export function padTo256Bits(hexString: string) {
  let hex &#x3D; hexString;
  if (hex.includes(&#x27;0x&#x27;)) {
    hex &#x3D; hex.slice(2);
  }
  if (hex.length &gt; 64) {
    throw new Error(&#x27;The hex string cannot be more than 256 bits (\&#x27;0x\&#x27; + 64 hex chars)&#x27;);
  }
  return &#x60;0x${hex.padStart(64, &#x27;0&#x27;)}&#x60;; // pad with &#x27;0&#x27; until it has a length of 64 nibbles (32 bytes) (256 bits)
}

/**
 * Transform a number into an hex string with a &#x60;0x&#x60; prefix and pad it to 256bit
 */
export function numberTo256Bits(num: number) {
  const hex &#x3D; numberToHexString(num);
  return padTo256Bits(hex);
}

/** Return the current value of the path from Firestore */
export async function snapshot&lt;T&gt;(path: string): Promise&lt;T&gt; {
  // If path targets a collection ( odd number of segments after the split )
  if (path.split(&#x27;/&#x27;).length % 2 !&#x3D;&#x3D; 0) {
    const snap &#x3D; await firebase.firestore().collection(path).get();
    return snap.docs.map(doc &#x3D;&gt; doc.data()) as any;
    // Else path targets a doc
  } else {
    const snap &#x3D; await firebase.firestore().doc(path).get();
    return snap.data() as any;
  }
}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'Key.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
