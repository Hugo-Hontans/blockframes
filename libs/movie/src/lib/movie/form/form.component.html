<mat-drawer-container class="movie-panel">
  <mat-drawer-content>
    <button mat-icon-button class="toggle-drawer" (click)="drawer.toggle()">
      <ng-container *ngIf="drawer.opened; else arrowLeft"><mat-icon>arrow_right</mat-icon></ng-container>
      <ng-template #arrowLeft>
        <mat-icon>arrow_left</mat-icon>
      </ng-template>
    </button>
    <movie-form-preview></movie-form-preview>
  </mat-drawer-content>
  <mat-drawer opened #drawer mode="side" position="end" [ngClass]="{ 'mat-drawer-fullscreen' : fullScreen }">
    <button mat-icon-button class="toggle-fullscreen" (click)="toggleFullScreen()">
      <ng-container *ngIf="fullScreen; else fullscreenExit"><mat-icon>fullscreen_exit</mat-icon></ng-container>
      <ng-template #fullscreenExit>
        <mat-icon>fullscreen</mat-icon>
      </ng-template>
    </button>
    <form [formGroup]="movieForm">
      <mat-card class="movie-card">
        <mat-card-content>
          <mat-tab-group>
            <mat-tab label="Main Informations">
              <!-- TITLES -->
              <h3> Titles </h3>
              <mat-form-field class="full-width">
                <input matInput formControlName="originalTitle" placeholder="Original title">
              </mat-form-field>
        
              <mat-form-field class="full-width">
                <input matInput formControlName="internationalTitle" placeholder="International title">
              </mat-form-field>

              <h3> Directed By </h3>
              <mat-form-field class="full-width">
                <input matInput formControlName="directorName" placeholder="Director name">
              </mat-form-field>
        
              <!-- POSTER -->
              <h3> Poster </h3>
              <mat-card class="movie-poster-thumbnail mat-elevation-z0">
                <ng-container *ngIf="currentFormValue('poster'); else fileUpload">
                  <img mat-card-image [src]="currentFormValue('poster')">
                  <mat-card-actions>
                    <button mat-raised-button color="warn" (click)="removePoster()"><mat-icon>delete_circle</mat-icon> Remove</button>
                  </mat-card-actions>
                </ng-container>
                <ng-template #fileUpload>
                  <file-upload
                    accept="['.jpg', '.png']"
                    path='test'
                    [types]="['image/jpeg', 'image/png']"
                    (storeUploaded)="addPoster($event)"
                  ></file-upload>
                </ng-template>
              </mat-card>
              <h3> Production </h3>
              <mat-form-field class="full-width">
                <input matInput formControlName="productionYear" placeholder="Production year">
              </mat-form-field>

              <!-- AUDIOVISUAL TYPES -->
              <h3> Types </h3>
              <mat-form-field class="full-width">
                <mat-select formControlName="types"  placeholder="Film Type" multiple>
                  <mat-option>
                    <ngx-mat-select-search 
                      [formControl]="audiovisual_typesFilterCtrl"
                      [placeholderLabel]="'Search...'" 
                      [noEntriesFoundLabel]="'no matching type found'"
                    ></ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let type of audiovisual_types | async" [value]="type.slug">
                    {{ type.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <!-- GENRES -->
              <h3> Genres </h3>
              <mat-form-field class="full-width">
                <mat-select formControlName="genres" placeholder="Genres" multiple>
                  <mat-option>
                    <ngx-mat-select-search 
                      [formControl]="genresFilterCtrl"
                      [placeholderLabel]="'Search...'" 
                      [noEntriesFoundLabel]="'no matching genre found'"
                    ></ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let genre of genres | async" [value]="genre.slug">
                    {{ genre.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <!-- ORIGIN COUNTRY -->
              <h3> Origin Country </h3>
              <mat-form-field class="full-width">
                <mat-select formControlName="originCountry" placeholder="Origin Country" [value]="movie.originCountry">
                  <mat-option>
                    <ngx-mat-select-search 
                      [formControl]="countriesFilterCtrl"
                      [placeholderLabel]="'Search...'" 
                      [noEntriesFoundLabel]="'no matching country found'"
                    ></ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let country of countries | async" [value]="country.slug">
                    {{ country.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <!-- CO-PRODUCER COUNTRIES -->
              <h3> Co Producers Countries </h3>
              <mat-form-field class="full-width">
                <mat-select formControlName="coProducerCountries" placeholder="Co Producers Countries" multiple>
                  <mat-option>
                    <ngx-mat-select-search 
                      [formControl]="countriesFilterCtrl"
                      [placeholderLabel]="'Search...'" 
                      [noEntriesFoundLabel]="'no matching country found'"
                    ></ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let country of countries | async" [value]="country.slug">
                    {{ country.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <!-- LANGUAGES -->
              <h3> Languages </h3>
              <mat-form-field class="full-width">
                <mat-select formControlName="languages" placeholder="Film Languages" multiple>
                  <mat-option>
                    <ngx-mat-select-search 
                      [formControl]="languagesFilterCtrl"
                      [placeholderLabel]="'Search...'" 
                      [noEntriesFoundLabel]="'no matching language found'"
                    ></ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor="let language of languages | async" [value]="language.slug">
                    {{ language.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <!-- STATUS -->
              <h3> Status </h3>
              <mat-form-field>
                <mat-select formControlName="status" placeholder="Status">
                  <mat-option *ngFor="let status of staticModels.MOVIE_STATUS" [value]="status.slug">
                    {{ status.label }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
                              
            </mat-tab>
            <mat-tab label="Story description">
              <!-- LOGLINE -->
              <h3> Logline </h3>
              <mat-form-field class="full-width">
                <textarea matInput #logline formControlName="logline" maxlength="180" placeholder="Logline" type="string"></textarea>
                <mat-hint align="end">{{ logline.value.length }} / 180</mat-hint>
              </mat-form-field>

              <!-- SYNOPSIS -->
              <h3> Synopsis </h3>
              <mat-form-field class="full-width">
                <textarea matInput #synopsis formControlName="synopsis" maxlength="500" placeholder="Synopsis" type="string"></textarea>
                <mat-hint align="end">{{ synopsis.value.length }} / 500</mat-hint>
              </mat-form-field>

              <!-- KEYWORDS -->
              <h3> Keywords </h3>
              <mat-form-field class="full-width">
                <mat-chip-list #chipList>
                  <mat-chip *ngFor="let keyword of keywords.controls ; let i = index;" [selectable]="true" [removable]="true" (removed)="removeFormControl(i, 'keywords')">
                    {{ keyword.value }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                  </mat-chip>
                  <input placeholder="Keywords"
                          [matChipInputFor]="chipList"
                          [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                          [matChipInputAddOnBlur]="true"
                          (matChipInputTokenEnd)="addChip($event, 'keywords')">
                </mat-chip-list>
              </mat-form-field>
            </mat-tab>
            <mat-tab label="Movie Team">
              <!-- CREDITS -->
              <h3> Credits </h3>
              <div formArrayName="credits" *ngFor="let credit of movieCredits.controls; let i = index;">
                <div [formGroupName]="i" class="full-width">
                  <mat-form-field class="small-width small-margin">
                    <input matInput formControlName="firstName" placeholder="First Name">
                  </mat-form-field>
                  <mat-form-field class="small-width small-margin">
                    <input matInput formControlName="lastName" placeholder="Last Name">
                  </mat-form-field>
                  <mat-form-field class="small-width small-margin">
                    <mat-select formControlName="creditRole" placeholder="Position">
                      <mat-option *ngFor="let creditRole of staticModels.CREDIT_ROLES" [value]="creditRole.slug">
                        {{ creditRole.label }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                  <button mat-icon-button color="primary" (click)="addCredit()">
                    <mat-icon>add_circle</mat-icon>
                  </button>
                  <button mat-icon-button color="primary" (click)="removeFormControl(i, 'movieCredits')">
                    <mat-icon>delete_circle</mat-icon>
                  </button>
                </div>
              </div>
              <div *ngIf="movieCredits.controls.length == 0">
                <button mat-icon-button color="primary" (click)="addCredit()">
                  <mat-icon>add_circle</mat-icon>
                </button>
              </div>
            </mat-tab>
            <mat-tab label="Promotional elements">
              <!-- Promotional elements -->
              <h3> Images </h3>
              <div formArrayName="images" *ngFor="let image of images.controls; let i = index;">
                <div [formGroupName]="i" class="full-width">
                  <mat-card class="movie-poster-thumbnail mat-elevation-z0">
                    <ng-container *ngIf="currentFormValue('images', i); else fileUpload">
                      <img mat-card-image [src]="currentFormValue('images', i)">
                    </ng-container>
                    <ng-template #fileUpload>
                      <file-upload
                        accept="['.jpg', '.png']"
                        path='test'
                        [types]="['image/jpeg', 'image/png']"
                        (storeUploaded)="setImage($event, i)"
                      ></file-upload>
                    </ng-template>
                    <mat-card-actions>
                      <button mat-raised-button color="warn" (click)="removeFormControl(i, 'images')"><mat-icon>delete_circle</mat-icon> Remove</button>
                    </mat-card-actions>
                  </mat-card>
                </div>
              </div>
              <div *ngIf="images.controls.length < 6">
                <button mat-icon-button color="primary" (click)="addImage()">
                  <mat-icon>add_circle</mat-icon>
                </button>
              </div>
              <!-- Other promotional elements -->
              <h3> Other Promotional Elements </h3>
              <div formArrayName="promotionalElements" *ngFor="let element of promotionalElements.controls; let i = index;">
                <div [formGroupName]="i" class="full-width">
                  <mat-form-field class="small-width small-margin">
                    <input matInput formControlName="label" placeholder="Label">
                  </mat-form-field>
                  <mat-form-field class="small-width small-margin">
                    <input matInput formControlName="url" placeholder="https://">
                  </mat-form-field>
                  <button mat-icon-button color="primary" (click)="addPromotionalElement()">
                    <mat-icon>add_circle</mat-icon>
                  </button>
                  <button mat-icon-button color="primary" (click)="removeFormControl(i, 'promotionalElements')">
                    <mat-icon>delete_circle</mat-icon>
                  </button>
                </div>
              </div>
              <div *ngIf="promotionalElements.controls.length == 0">
                <button mat-icon-button color="primary" (click)="addPromotionalElement()">
                  <mat-icon>add_circle</mat-icon>
                </button>
              </div>
            </mat-tab>
          </mat-tab-group>
        </mat-card-content>
          
        <mat-card-actions>
          <button mat-raised-button color="warn" (click)="cancel()">Cancel</button>
          <button mat-raised-button color="primary" (click)="submit()" type="submit">Save movie</button>
        </mat-card-actions>
      </mat-card>
    </form>
  </mat-drawer>
</mat-drawer-container>
